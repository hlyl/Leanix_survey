name: Syntax & Build Check

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  syntax:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.12"]

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version }}

      - name: Check Python syntax
        run: |
          python -m py_compile src/*.py tests/*.py tests/integration/*.py

      - name: Validate JSON files
        run: |
          python -c "
          import json
          import glob
          for f in glob.glob('examples/*.json') + glob.glob('*.json'):
              try:
                  with open(f) as j:
                      json.load(j)
                  print(f'✓ {f}')
              except Exception as e:
                  print(f'✗ {f}: {e}')
                  exit(1)
          "

      - name: Check for common issues
        run: |
          python -c "
          import os
          import re
          
          issues = []
          for root, dirs, files in os.walk('src'):
              for file in files:
                  if file.endswith('.py'):
                      path = os.path.join(root, file)
                      with open(path) as f:
                          content = f.read()
                          if re.search(r'print\(', content):
                              issues.append(f'{path}: contains print() - use logging instead')
                              
          if issues:
              for issue in issues:
                  print(f'⚠ {issue}')
          else:
              print('✓ No common issues found')
          "
        continue-on-error: true
